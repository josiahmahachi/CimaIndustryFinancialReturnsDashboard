@* This page is no longer active - use Filings.razor instead *@
@page "/dashboard-old"
@layout MainLayout
@using blazor_wasm_ui.Models;
@using blazor_wasm_ui.Shared;

<PageTitle>Filings - Financial Returns Dashboard</PageTitle>

<div class="dashboard-container">
    <!-- Top Navigation - Tab Switcher -->
    <TopNavigation 
        ActiveTab="@ActiveTab" 
        OnTabChange="@OnTabChange" />

    <!-- Conditional Content Rendering Based on Active Tab -->
    @if (ActiveTab == "reports-analytics")
    {
        <!-- Reports & Analytics Tab -->
        <div class="tab-content">
            <h1 class="page-title">Reports & Analytics</h1>
            <p class="page-description">View detailed analytics, charts, and reporting metrics for your financial filings.</p>
            
            <section class="content-section">
                <h3>Reports & Analytics Content</h3>
                <p>Placeholder for ReportsAnalyticsTab component</p>
            </section>
        </div>
    }
    else
    {
        <!-- Filing Tabs (Active, Submitted, Returned) -->
        <div class="tab-content">
            <!-- Tab Title and Description -->
            <div class="tab-header">
                <h1 class="page-title">@GetTabTitle()</h1>
                <p class="page-description">@GetTabDescription()</p>
            </div>

            <!-- Filters Section -->
            <FiltersSection 
                FundType="@(FundType == Models.FundType.None ? "all" : FundType == Models.FundType.MutualFund ? "mutual" : "private")" 
                ActiveTab="@ActiveTab"
                OnResetFilters="@HandleResetFilters" />

            <!-- Returns Table -->
            <ReturnsTable 
                Returns="@FilteredReturns" 
                ActiveTab="@ActiveTab" />

            <!-- Help Section (placeholder) -->
            <section class="help-section-placeholder">
                <h3>Help Section</h3>
                <p>Help and support information will appear here</p>
            </section>
        </div>
    }
</div>

@code {
    // State Management
    private string ActiveTab = "active";
    private FundType FundType = FundType.None;
    private List<FinancialReturn> MockReturns { get; set; } = new();
    private List<FinancialReturn> FilteredReturns { get; set; } = new();

    /// <summary>
    /// Handle tab change event
    /// </summary>
    private void OnTabChange(string newTab)
    {
        ActiveTab = newTab;
        ApplyFilters();
    }

    /// <summary>
    /// Reset all filters to default state
    /// </summary>
    private Task HandleResetFilters()
    {
        FundType = FundType.None;
        ApplyFilters();
        return Task.CompletedTask;
    }

    /// <summary>
    /// Apply filters to returns based on current tab and filter settings
    /// </summary>
    private void ApplyFilters()
    {
        FilteredReturns = MockReturns
            .Where(r => FilterByTab(r) && FilterByFundType(r))
            .ToList();
    }

    /// <summary>
    /// Filter returns based on active tab
    /// </summary>
    private bool FilterByTab(FinancialReturn ret)
    {
        return ActiveTab switch
        {
            "active" => IsActiveStatus(ret.Status),
            "submitted" => ret.Status == ReturnStatus.Processed,
            "returned" => ret.Status == ReturnStatus.Returned,
            "reports-analytics" => true,
            _ => true
        };
    }

    /// <summary>
    /// Filter returns based on fund type
    /// </summary>
    private bool FilterByFundType(FinancialReturn ret)
    {
        if (FundType == FundType.None) return true;
        
        var targetFundType = FundType == FundType.None ? FundType.MutualFund : FundType.PrivateFund;
        return ret.FundType == targetFundType;
    }

    /// <summary>
    /// Check if status is considered "active"
    /// </summary>
    private bool IsActiveStatus(ReturnStatus status)
    {
        return status is ReturnStatus.Available 
            or ReturnStatus.Prepared 
            or ReturnStatus.ReadyToSubmit 
            or ReturnStatus.Outstanding 
            or ReturnStatus.Deferred;
    }

    /// <summary>
    /// Get tab title based on active tab
    /// </summary>
    private string GetTabTitle()
    {
        return ActiveTab switch
        {
            "active" => "Active Filings",
            "submitted" => "Submitted Filings",
            "returned" => "Returned Filings",
            _ => "Returns Filing & Extension Management Portal"
        };
    }

    /// <summary>
    /// Get tab description based on active tab
    /// </summary>
    private string GetTabDescription()
    {
        return ActiveTab switch
        {
            "active" => "Filings that are actively being worked on or pending action. Includes available, prepared, ready to submit, outstanding, and deferred filings.",
            "submitted" => "Filings that have been successfully processed by the authority. View your filing history and approved extensions.",
            "returned" => "Filings that were rejected or sent back by the authority requiring amendments. Review feedback and resubmit your filings.",
            _ => "Returns Filing & Extension Management Portal"
        };
    }

    /// <summary>
    /// Initialize mock data
    /// </summary>
    protected override void OnInitialized()
    {
        InitializeMockData();
        ApplyFilters();
        base.OnInitialized();
    }

    /// <summary>
    /// Create mock financial returns data (from React App.tsx mockReturnsData)
    /// </summary>
    private void InitializeMockData()
    {
        MockReturns = new List<FinancialReturn>
        {
            new()
            {
                Id = "1",
                EntityId = "101",
                FundName = "Healthcare Innovation Fund",
                FundType = FundType.MutualFund,
                FundStructure = FundStructure.SingleFund,
                Period = "Q4 2024",
                PeriodDescription = "Oct 1 - Dec 31, 2024",
                Status = ReturnStatus.Available,
                ExtensionsUsed = 0,
                UsedExtensionDays = 0,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = null,
                PendingRequestStatus = null,
            },
            new()
            {
                Id = "2",
                EntityId = "102",
                FundName = "Technology Growth Fund",
                FundType = FundType.PrivateFund,
                Period = "FY 2024",
                PeriodDescription = "Jan 1 - Dec 31, 2024",
                Status = ReturnStatus.Available,
                ExtensionsUsed = 1,
                UsedExtensionDays = 30,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = PendingRequestType.Extension,
                PendingRequestStatus = PendingRequestStatus.Pending,
            },
            new()
            {
                Id = "3",
                EntityId = "103",
                FundName = "Emerging Markets Equity Fund",
                FundType = FundType.MutualFund,
                FundStructure = FundStructure.SingleFund,
                Period = "FY 2024",
                PeriodDescription = "Jan 1 - Dec 31, 2024",
                Status = ReturnStatus.Outstanding,
                ExtensionsUsed = 3,
                UsedExtensionDays = 90,
                MaxExtensions = 3,
                CanRequestExtension = false,
                PendingRequestType = null,
                PendingRequestStatus = null,
            },
            new()
            {
                Id = "4",
                EntityId = "104",
                FundName = "Real Estate Investment Fund",
                FundType = FundType.PrivateFund,
                Period = "Q2 2024",
                PeriodDescription = "Apr 1 - Jun 30, 2024",
                Status = ReturnStatus.Processed,
                ExtensionsUsed = 1,
                UsedExtensionDays = 30,
                MaxExtensions = 3,
                CanRequestExtension = false,
                PendingRequestType = null,
                PendingRequestStatus = null,
            },
            new()
            {
                Id = "5",
                EntityId = "105",
                FundName = "Global Equity Sub-Fund",
                FundType = FundType.MutualFund,
                FundStructure = FundStructure.MultiFund,
                ParentFundName = "Sustainable Growth Multi-Fund Complex",
                Period = "Q4 2024",
                PeriodDescription = "Oct 1 - Dec 31, 2024",
                Status = ReturnStatus.Available,
                ExtensionsUsed = 0,
                UsedExtensionDays = 0,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = PendingRequestType.Waiver,
                PendingRequestStatus = PendingRequestStatus.Pending,
            },
            new()
            {
                Id = "6",
                EntityId = "106",
                FundName = "Infrastructure Development Fund",
                FundType = FundType.PrivateFund,
                Period = "Q3 2024",
                PeriodDescription = "Jul 1 - Sep 30, 2024",
                Status = ReturnStatus.Prepared,
                ExtensionsUsed = 1,
                UsedExtensionDays = 30,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = null,
                PendingRequestStatus = null,
            },
            new()
            {
                Id = "7",
                EntityId = "107",
                FundName = "Small Cap Growth Fund",
                FundType = FundType.MutualFund,
                FundStructure = FundStructure.SingleFund,
                Period = "Q2 2024",
                PeriodDescription = "Apr 1 - Jun 30, 2024",
                Status = ReturnStatus.ReadyToSubmit,
                ExtensionsUsed = 0,
                UsedExtensionDays = 0,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = PendingRequestType.Deferral,
                PendingRequestStatus = PendingRequestStatus.Pending,
            },
            new()
            {
                Id = "8",
                EntityId = "108",
                FundName = "Asia Pacific Growth Fund",
                FundType = FundType.MutualFund,
                FundStructure = FundStructure.SingleFund,
                Period = "Q3 2024",
                PeriodDescription = "Jul 1 - Sep 30, 2024",
                Status = ReturnStatus.Returned,
                ExtensionsUsed = 1,
                UsedExtensionDays = 30,
                MaxExtensions = 3,
                CanRequestExtension = false,
                PendingRequestType = null,
                PendingRequestStatus = null,
            },
            new()
            {
                Id = "9",
                EntityId = "109",
                FundName = "Sustainable Energy Fund",
                FundType = FundType.PrivateFund,
                Period = "FY 2023",
                PeriodDescription = "Jan 1 - Dec 31, 2023",
                Status = ReturnStatus.Returned,
                ExtensionsUsed = 2,
                UsedExtensionDays = 60,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = null,
                PendingRequestStatus = null,
            },
            new()
            {
                Id = "10",
                EntityId = "110",
                FundName = "European Bond Fund",
                FundType = FundType.MutualFund,
                FundStructure = FundStructure.SingleFund,
                Period = "Q1 2024",
                PeriodDescription = "Jan 1 - Mar 31, 2024",
                Status = ReturnStatus.Returned,
                ExtensionsUsed = 0,
                UsedExtensionDays = 0,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = null,
                PendingRequestStatus = null,
            },
            new()
            {
                Id = "11",
                EntityId = "111",
                FundName = "Emerging Markets Bond Fund",
                FundType = FundType.MutualFund,
                FundStructure = FundStructure.SingleFund,
                Period = "Q4 2024",
                PeriodDescription = "Oct 1 - Dec 31, 2024",
                Status = ReturnStatus.Available,
                ExtensionsUsed = 2,
                UsedExtensionDays = 60,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = null,
                PendingRequestStatus = null,
            },
            new()
            {
                Id = "12",
                EntityId = "112",
                FundName = "Commodity Trading Fund",
                FundType = FundType.PrivateFund,
                Period = "FY 2024",
                PeriodDescription = "Jan 1 - Dec 31, 2024",
                Status = ReturnStatus.Available,
                ExtensionsUsed = 0,
                UsedExtensionDays = 0,
                MaxExtensions = 3,
                CanRequestExtension = true,
                PendingRequestType = null,
                PendingRequestStatus = null,
            }
        };
    }
}

<style>
    .dashboard-container {
        width: 100%;
    }

    .tab-content {
        width: 100%;
    }

    .tab-header {
        margin-bottom: 2rem;
    }

    .page-title {
        font-size: 1.875rem;
        color: #111827;
        margin: 0 0 0.5rem 0;
    }

    .page-description {
        color: #6b7280;
        margin: 0;
    }

    .content-section {
        background: #f3f4f6;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .content-section h3 {
        margin: 0 0 0.5rem 0;
        color: #111827;
        font-size: 1.125rem;
    }

    .content-section p {
        margin: 0;
        color: #6b7280;
        font-size: 0.875rem;
    }

    .help-section-placeholder {
        background: #f3f4f6;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        padding: 1.5rem;
        margin-top: 2rem;
    }

    .help-section-placeholder h3 {
        margin: 0 0 0.5rem 0;
        color: #111827;
        font-size: 1.125rem;
    }

    .help-section-placeholder p {
        margin: 0;
        color: #6b7280;
        font-size: 0.875rem;
    }
</style>
